#include "IME/IMELatin.h"
#include "stdio.h"

unsigned short charmap[Latin_All][20][4] =
{
//dutch
{
    {0x00c1,0x00c4,0x0000,0x0000},//A
    {0x0000,0x0000,0x0000,0x0000},//C
    {0x00c8,0x00c9,0x00cb,0x0000},//E
    {0x0000,0x0000,0x0000,0x0000},//G
    {0x00cf,0x0000,0x0000,0x0000},//I
    {0x0000,0x0000,0x0000,0x0000},//N
    {0x00d3,0x00d6,0x0000,0x0000},//O
    {0x0000,0x0000,0x0000,0x0000},//S
    {0x00da,0x00dc,0x0000,0x0000},//U
    {0x0000,0x0000,0x0000,0x0000},//Y
    {0x00e1,0x00e4,0x0000,0x0000},//a
    {0x0000,0x0000,0x0000,0x0000},//c
    {0x00e8,0x00e9,0x00eb,0x0000},//e
    {0x0000,0x0000,0x0000,0x0000},//g
    {0x00ef,0x0000,0x0000,0x0000},//i
    {0x0000,0x0000,0x0000,0x0000},//n
    {0x00f3,0x00f6,0x0000,0x0000},//o
    {0x0000,0x0000,0x0000,0x0000},//s
    {0x00fa,0x00fc,0x0000,0x0000},//u
    {0x0000,0x0000,0x0000,0x0000}//y

},
//finnish
{
    {0x00c4,0x00c5,0x0000,0x0000},//A
    {0x0000,0x0000,0x0000,0x0000},//C
    {0x0000,0x0000,0x0000,0x0000},//E
    {0x0000,0x0000,0x0000,0x0000},//G
    {0x0000,0x0000,0x0000,0x0000},//I
    {0x0000,0x0000,0x0000,0x0000},//N
    {0x00d6,0x0000,0x0000,0x0000},//O
    {0x0000,0x0000,0x0000,0x0000},//S
    {0x0000,0x0000,0x0000,0x0000},//U
    {0x0000,0x0000,0x0000,0x0000},//Y
    {0x00e4,0x00e5,0x0000,0x0000},//a
    {0x0000,0x0000,0x0000,0x0000},//c
    {0x0000,0x0000,0x0000,0x0000},//e
    {0x0000,0x0000,0x0000,0x0000},//g
    {0x0000,0x0000,0x0000,0x0000},//i
    {0x0000,0x0000,0x0000,0x0000},//n
    {0x00f6,0x0000,0x0000,0x0000},//o
    {0x0000,0x0000,0x0000,0x0000},//s
    {0x0000,0x0000,0x0000,0x0000},//u
    {0x0000,0x0000,0x0000,0x0000}//y
},
//french
{
    {0x00c2,0x00c0,0x00c6,0x0000},//A
    {0x00c7,0x0000,0x0000,0x0000},//C
    {0x00c8,0x00c9,0x00ca,0x00cb},//E
    {0x0000,0x0000,0x0000,0x0000},//G
    {0x00ce,0x00cf,0x0000,0x0000},//I
    {0x0000,0x0000,0x0000,0x0000},//N
    {0x00d4,0x00d6,0x0152,0x0000},//O
    {0x0000,0x0000,0x0000,0x0000},//S
    {0x00d9,0x00db,0x00dc,0x0000},//U
    {0x0178,0x0000,0x0000,0x0000},//Y
    {0x00e2,0x00e0,0x00e6,0x0000},//a
    {0x00e7,0x0000,0x0000,0x0000},//c
    {0x00e8,0x00e9,0x00ea,0x00eb},//e
    {0x0000,0x0000,0x0000,0x0000},//g
    {0x00ee,0x00ef,0x0000,0x0000},//i
    {0x0000,0x0000,0x0000,0x0000},//n
    {0x00f4,0x00f6,0x0153,0x0000},//o
    {0x0000,0x0000,0x0000,0x0000},//s
    {0x00f9,0x00fb,0x00fc,0x0000},//u
    {0x00ff,0x0000,0x0000,0x0000}//y
},
//german
{
    {0x00c4,0x0000,0x0000,0x0000},//A
    {0x0000,0x0000,0x0000,0x0000},//C
    {0x0000,0x0000,0x0000,0x0000},//E
    {0x0000,0x0000,0x0000,0x0000},//G
    {0x0000,0x0000,0x0000,0x0000},//I
    {0x0000,0x0000,0x0000,0x0000},//N
    {0x00d6,0x0000,0x0000,0x0000},//O
    {0x00df,0x0000,0x0000,0x0000},//S
    {0x00dc,0x0000,0x0000,0x0000},//U
    {0x0000,0x0000,0x0000,0x0000},//Y
    {0x00e4,0x0000,0x0000,0x0000},//a
    {0x0000,0x0000,0x0000,0x0000},//c
    {0x0000,0x0000,0x0000,0x0000},//e
    {0x0000,0x0000,0x0000,0x0000},//g
    {0x0000,0x0000,0x0000,0x0000},//i
    {0x0000,0x0000,0x0000,0x0000},//n
    {0x00f6,0x0000,0x0000,0x0000},//o
    {0x00df,0x0000,0x0000,0x0000},//s
    {0x00fc,0x0000,0x0000,0x0000},//u
    {0x0000,0x0000,0x0000,0x0000}//y
},
//italy
{
    {0x00c0,0x0000,0x0000,0x0000},//A
    {0x0000,0x0000,0x0000,0x0000},//C
    {0x00c8,0x00c9,0x0000,0x0000},//E
    {0x0000,0x0000,0x0000,0x0000},//G
    {0x00cc,0x0000,0x0000,0x0000},//I
    {0x0000,0x0000,0x0000,0x0000},//N
    {0x00d2,0x0000,0x0000,0x0000},//O
    {0x0000,0x0000,0x0000,0x0000},//S
    {0x00d9,0x0000,0x0000,0x0000},//U
    {0x0000,0x0000,0x0000,0x0000},//Y
    {0x00e0,0x0000,0x0000,0x0000},//a
    {0x0000,0x0000,0x0000,0x0000},//c
    {0x00e8,0x00e9,0x0000,0x0000},//e
    {0x0000,0x0000,0x0000,0x0000},//g
    {0x00ec,0x0000,0x0000,0x0000},//i
    {0x0000,0x0000,0x0000,0x0000},//n
    {0x00f2,0x0000,0x0000,0x0000},//o
    {0x0000,0x0000,0x0000,0x0000},//s
    {0x00f9,0x0000,0x0000,0x0000},//u
    {0x0000,0x0000,0x0000,0x0000}//y
},
//norwegian
{
    {0x00c6,0x00c5,0x0000,0x0000},//A
    {0x0000,0x0000,0x0000,0x0000},//C
    {0x0000,0x0000,0x0000,0x0000},//E
    {0x0000,0x0000,0x0000,0x0000},//G
    {0x0000,0x0000,0x0000,0x0000},//I
    {0x0000,0x0000,0x0000,0x0000},//N
    {0x00d8,0x0000,0x0000,0x0000},//O
    {0x0000,0x0000,0x0000,0x0000},//S
    {0x0000,0x0000,0x0000,0x0000},//U
    {0x0000,0x0000,0x0000,0x0000},//Y
    {0x00e6,0x00e5,0x0000,0x0000},//a
    {0x0000,0x0000,0x0000,0x0000},//c
    {0x0000,0x0000,0x0000,0x0000},//e
    {0x0000,0x0000,0x0000,0x0000},//g
    {0x0000,0x0000,0x0000,0x0000},//i
    {0x0000,0x0000,0x0000,0x0000},//n
    {0x00f8,0x0000,0x0000,0x0000},//o
    {0x0000,0x0000,0x0000,0x0000},//s
    {0x0000,0x0000,0x0000,0x0000},//u
    {0x0000,0x0000,0x0000,0x0000}//y
},
//portuguese
{
    {0x00c1,0x00c0,0x00c3,0x00c2},//A
    {0x00c7,0x0000,0x0000,0x0000},//C
    {0x00c9,0x00ca,0x0000,0x0000},//E
    {0x0000,0x0000,0x0000,0x0000},//G
    {0x00cd,0x0000,0x0000,0x0000},//I
    {0x00d1,0x0000,0x0000,0x0000},//N
    {0x00d3,0x00d5,0x00d4,0x0000},//O
    {0x0000,0x0000,0x0000,0x0000},//S
    {0x00da,0x00dc,0x0000,0x0000},//U
    {0x0000,0x0000,0x0000,0x0000},//Y
    {0x00e1,0x00e0,0x00e3,0x00e2},//a
    {0x00e7,0x0000,0x0000,0x0000},//c
    {0x00e9,0x00ea,0x0000,0x0000},//e
    {0x0000,0x0000,0x0000,0x0000},//g
    {0x00ed,0x0000,0x0000,0x0000},//i
    {0x00f1,0x0000,0x0000,0x0000},//n
    {0x00f3,0x00f5,0x00f4,0x0000},//o
    {0x0000,0x0000,0x0000,0x0000},//s
    {0x00fa,0x00fc,0x0000,0x0000},//u
    {0x0000,0x0000,0x0000,0x0000}//y
},
//spanish
{
    {0x00c1,0x0000,0x0000,0x0000},//A
    {0x0000,0x0000,0x0000,0x0000},//C
    {0x00c9,0x0000,0x0000,0x0000},//E
    {0x0000,0x0000,0x0000,0x0000},//G
    {0x00cd,0x0000,0x0000,0x0000},//I
    {0x00d1,0x0000,0x0000,0x0000},//N
    {0x00d3,0x0000,0x0000,0x0000},//O
    {0x0000,0x0000,0x0000,0x0000},//S
    {0x00da,0x00dc,0x0000,0x0000},//U
    {0x0000,0x0000,0x0000,0x0000},//Y
    {0x00e1,0x0000,0x0000,0x0000},//a
    {0x0000,0x0000,0x0000,0x0000},//c
    {0x00e9,0x0000,0x0000,0x0000},//e
    {0x0000,0x0000,0x0000,0x0000},//g
    {0x00ed,0x0000,0x0000,0x0000},//i
    {0x00f1,0x0000,0x0000,0x0000},//n
    {0x00f3,0x0000,0x0000,0x0000},//o
    {0x0000,0x0000,0x0000,0x0000},//s
    {0x00fa,0x00fc,0x0000,0x0000},//u
    {0x0000,0x0000,0x0000,0x0000}//y
},
//swedish
{
    {0x00c4,0x00c5,0x0000,0x0000},//A
    {0x0000,0x0000,0x0000,0x0000},//C
    {0x00c9,0x0000,0x0000,0x0000},//E
    {0x0000,0x0000,0x0000,0x0000},//G
    {0x0000,0x0000,0x0000,0x0000},//I
    {0x0000,0x0000,0x0000,0x0000},//N
    {0x00d6,0x0000,0x0000,0x0000},//O
    {0x0000,0x0000,0x0000,0x0000},//S
    {0x0000,0x0000,0x0000,0x0000},//U
    {0x0000,0x0000,0x0000,0x0000},//Y
    {0x00e4,0x00e5,0x0000,0x0000},//a
    {0x0000,0x0000,0x0000,0x0000},//c
    {0x00e9,0x0000,0x0000,0x0000},//e
    {0x0000,0x0000,0x0000,0x0000},//g
    {0x0000,0x0000,0x0000,0x0000},//i
    {0x0000,0x0000,0x0000,0x0000},//n
    {0x00f6,0x0000,0x0000,0x0000},//o
    {0x0000,0x0000,0x0000,0x0000},//s
    {0x0000,0x0000,0x0000,0x0000},//u
    {0x0000,0x0000,0x0000,0x0000}//y
},
//turkish
{
    {0x00c2,0x0000,0x0000,0x0000},//A
    {0x00c7,0x0000,0x0000,0x0000},//C
    {0x0000,0x0000,0x0000,0x0000},//E
    {0x011e,0x0000,0x0000,0x0000},//G
    {0x0130,0x00ce,0x0000,0x0000},//I
    {0x0000,0x0000,0x0000,0x0000},//N
    {0x00d6,0x0000,0x0000,0x0000},//O
    {0x015e,0x0000,0x0000,0x0000},//S
    {0x00db,0x00dc,0x0000,0x0000},//U
    {0x0000,0x0000,0x0000,0x0000},//Y
    {0x00e2,0x0000,0x0000,0x0000},//a
    {0x00e7,0x0000,0x0000,0x0000},//c
    {0x0000,0x0000,0x0000,0x0000},//e
    {0x011f,0x0000,0x0000,0x0000},//g
    {0x0131,0x00ee,0x0000,0x0000},//i
    {0x0000,0x0000,0x0000,0x0000},//n
    {0x00f6,0x0000,0x0000,0x0000},//o
    {0x015f,0x0000,0x0000,0x0000},//s
    {0x00fb,0x00fc,0x0000,0x0000},//u
    {0x0000,0x0000,0x0000,0x0000}//y
}};



IMELatin::IMELatin()
{
    m_strInputString[0] = 0;
    m_strInputString[1] = 0;
    this->m_iCharCount = 0;
    m_eLatinType = Latin_All;
    m_fIsLocking = 0;
    m_strResult[0] = 0;
}


void IMELatin:: Init()
{
    
}
eProcessResult IMELatin::ProcessKeys(char iASCIICode)
{    
    int i = 0;
    switch(iASCIICode)
    {
    case 'A':
        i = 0;
        break;
    case 'C':
        i = 1;
        break;
    case 'E':
        i = 2;
        break;
    case 'G':
        i = 3;
        break;
    case 'I':
        i = 4;
        break;
    case 'N':
        i = 5;
        break;
    case 'O':
        i = 6;
        break;
    case 'S':
        i = 7;
        break;
    case 'U':
        i = 8;
        break;
    case 'Y':
        i = 9;
        break;
    case 'a':
        i = 10;
        break;
    case 'c':
        i = 11;
        break;
    case 'e':
        i = 12;
        break;
    case 'g':
        i = 13;
        break;
    case 'i':
        i = 14;
        break;
    case 'n':
        i = 15;
        break;
    case 'o':
        i = 16;
        break;
    case 's':
        i = 17;
        break;
    case 'u':
        i = 18;
        break;
    case 'y':
        i = 19;
        break;
    default:
        i = -1;
        break;
    }
    if(i == -1)
    {
        if((iASCIICode >= 'a' && iASCIICode <= 'z') || (iASCIICode >= 'A' && iASCIICode <= 'Z'))
        {
            
            if(m_strInputString[0])
            {
                m_strResult[0] = m_strInputString[0];
                m_strResult[1] = iASCIICode;
                m_strResult[2] = 0;
            }
            else
            {
                m_strResult[0] = iASCIICode;
                m_strResult[1] = 0;
            }
            m_iCharCount = 0;
            m_fIsLocking = 0;
            return PROCESSED_WITH_RESULT;
        }
        else
        {
            if(m_strInputString[0] && iASCIICode == 8/*del*/)
            {
                m_strInputString[0] = 0;
                m_iCharCount = 0;
                return PROCESSED_NO_RESULT;
            }
            else
            {
                return CAN_NOT_PROCESS;
            }
        }
    }
    else
    {
        m_iCharCount = 0;
        m_rgcLatinChar[m_iCharCount++] = iASCIICode;
        if(m_eLatinType != Latin_All)
        {
            for(int j = 0 ; j < 4 ; j++)
            {
                
                if(charmap[m_eLatinType][i][j] != 0 )
                {
                    m_rgcLatinChar[m_iCharCount++] =  charmap[m_eLatinType][i][j];
                }
                else
                {
                    break;
                }
            }
        }
        else
        {
            for(int index=0; index < Latin_All ; index++)
            {
                for(int j = 0 ; j < 4 ; j++)
                {
                    if(charmap[index][i][j] != 0 )
                    {
                        //去掉重复
                        m_rgcLatinChar[m_iCharCount++] = charmap[index][i][j];
                        for(unsigned int k = 0; k < m_iCharCount-1 ; k++)
                        {
                            if(m_rgcLatinChar[k] == charmap[index][i][j])
                            {
                                m_iCharCount--;
                                break;
                            }
                        }
                    }
                    else
                    {
                        //跳出该国语言
                        break;
                    }
                }
            }
        }        


        if(m_strInputString[0])
        {
            if(m_iCharCount)
            {
                m_fIsLocking = 1;
                m_strResult[0] = m_strInputString[0];
                m_strResult[1] = 0;
                m_strInputString[0] = iASCIICode;
                m_strInputString[1] = 0;
                return PROCESSED_WITH_RESULT;
            }
            else
            {
                m_fIsLocking = 0;
                m_strResult[0] = m_strInputString[0];
                m_strResult[1] = iASCIICode;
                m_strResult[2] = 0;
                m_strInputString[0] = iASCIICode;
                m_strInputString[1] = 0;
                return PROCESSED_WITH_RESULT;
            }
        }
        else
        {
            m_fIsLocking = 0;
            m_strInputString[0] = iASCIICode;
            m_strInputString[1] = 0;
            if(m_iCharCount)
            {
                return PROCESSED_NO_RESULT;
            }
            else
            {
                m_strResult[0] = iASCIICode;
                m_strResult[1] = 0;
                return PROCESSED_WITH_RESULT;
            }
        }
    }
}
eProcessResult IMELatin::SelectIndex(int iIndex) 
{
    m_fIsLocking = 0;
    if(iIndex < (int)m_iCharCount)
    {
        m_strResult[0] = m_rgcLatinChar[iIndex];
        m_strResult[1] = 0;
        return PROCESSED_WITH_RESULT;
    }
    else
    {
        return CAN_NOT_PROCESS;
    }
}
std::string IMELatin::GetResultString()
{
    return m_strResult;
}

std::string IMELatin::GetInputString()
{
    return m_strInputString;
}

std::string IMELatin::GetStringByIndex(unsigned int Index)
{
    if(Index < m_iCharCount)
    {
        m_cTmpChar[0] =  m_rgcLatinChar[Index];
        m_cTmpChar[1] = 0;
        return m_cTmpChar;
    }
    else
    {
        m_cTmpChar[0] = 0;
        return NULL;
    }
}

unsigned int IMELatin::SetInputIndex(unsigned int CurIndex) 
{
    return 0;
}

unsigned int IMELatin::GetInputIndex()
{
    return 0;
}

void IMELatin::Reset()
{
    m_strResult[0] = 0;
    if(!m_fIsLocking)
    {
        m_strInputString[0] = 0;
        m_strInputString[1] = 0;
        this->m_iCharCount = 0;
    }
}

